{% extends 'base.html' %}
{% load static %}

{% block title %}My Daily Wins - Week of {{ week_label }}{% endblock %}

{% block content %}
<!-- Override base template styles -->
<style>
    /* Reset and override any conflicting styles from base template */
    .week-container,
    .week-container * {
        box-sizing: border-box;
    }
    
    /* Hide base template card styling for our custom cards */
    .week-container .card {
        box-shadow: none !important;
        border: none !important;
        margin-bottom: 0 !important;
    }
</style>

<div class="week-container">
    <!-- Week Header with Rainbow Border -->
    <div style="
        position: relative;
        margin-bottom: 40px;
        padding: 6px;
        background: linear-gradient(90deg, #ff6b6b, #ffa726, #66bb6a, #42a5f5, #ab47bc);
        background-size: 300% 100%;
        animation: gradient-shift 3s ease infinite;
        border-radius: 26px;
    ">
        <div style="
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            position: relative;
        ">
            <h1 style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;">‚ú® My Daily Wins ‚ú®</h1>
            <p style="font-size: 1.2rem; opacity: 0.9;">Week of {{ week_label }}</p>
            
            <div style="display: flex; justify-content: center; gap: 30px; margin: 20px 0;">
                <div style="text-align: center;">
                    <span style="font-size: 2rem; font-weight: bold; display: block;">{{ week_stats.entries_count }}</span>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Entries This Week</span>
                </div>
                {% if week_stats.avg_mood %}
                <div style="text-align: center;">
                    <span style="font-size: 2rem; font-weight: bold; display: block;">{{ week_stats.avg_mood }}</span>
                    <span style="font-size: 0.9rem; opacity: 0.8;">Average Mood</span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Week Navigation -->
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
        <a href="?week={{ prev_week }}" style="
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        " onmouseover="this.style.background='#5a6268'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='#6c757d'; this.style.transform='translateY(0)'">
            ‚Üê Previous Week
        </a>
        
        {% if not is_current_week %}
        <a href="{% url 'weekly_dashboard' %}" style="
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        ">
            üè† Current Week
        </a>
        {% endif %}
        
        <a href="?week={{ next_week }}" style="
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        " onmouseover="this.style.background='#5a6268'; this.style.transform='translateY(-2px)'" onmouseout="this.style.background='#6c757d'; this.style.transform='translateY(0)'">
            Next Week ‚Üí
        </a>
    </div>
    
    <!-- Week Grid using Flexbox for guaranteed compatibility -->
    <div style="
        display: flex;
        flex-wrap: wrap;
        gap: 25px;
        margin: 40px 0;
        justify-content: center;
    ">
        {% for day in week_days %}
        <div class="day-card-clickable" 
             data-date="{{ day.date|date:'Y-m-d' }}"
             style="
                background: white;
                border-radius: 20px;
                padding: 25px;
                box-shadow: 0 8px 25px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
                cursor: pointer;
                position: relative;
                overflow: hidden;
                min-height: 280px;
                flex: 1 1 280px;
                max-width: 350px;
                border: 3px solid {% if day.is_today %}#28a745{% elif day.entry.has_content %}#667eea{% else %}transparent{% endif %};
                {% if day.is_today %}
                background: linear-gradient(135deg, #f8fff9 0%, #ffffff 100%);
                {% elif day.entry.has_content %}
                background: linear-gradient(135deg, #fff3e0 0%, #ffffff 100%);
                {% elif day.is_future %}
                opacity: 0.7;
                {% else %}
                opacity: 0.95;
                {% endif %}
             "
             onmouseover="this.style.transform='translateY(-8px) scale(1.02)'; this.style.boxShadow='0 15px 40px rgba(0,0,0,0.15)'"
             onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.1)'">
            
            <!-- Gradient Top Border -->
            <div style="
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 6px;
                background: linear-gradient(90deg, #ff6b6b, #ffa726, #66bb6a, #42a5f5, #ab47bc);
            "></div>
            
            <!-- Day Header -->
            <div style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
                padding-bottom: 15px;
                border-bottom: 2px solid #f8f9fa;
            ">
                <div>
                    <h3 style="margin: 0; font-size: 1.4rem; color: #2c3e50; font-weight: 600;">{{ day.day_name }}</h3>
                    <div style="font-size: 0.9rem; color: #6c757d; margin-top: 5px;">{{ day.date|date:'M j, Y' }}</div>
                </div>
                <div style="font-size: 2.5rem; font-weight: bold; color: #667eea; opacity: 0.3;">{{ day.day_number }}</div>
            </div>
            
            <!-- Status Indicator -->
            <div style="margin-bottom: 15px;">
                {% if day.is_today %}
                    <span style="background: #28a745; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 500;">Today</span>
                {% elif day.is_past %}
                    <span style="background: #6c757d; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 500;">Past</span>
                {% else %}
                    <span style="background: #17a2b8; color: white; padding: 4px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 500;">Future</span>
                {% endif %}
            </div>
            
            <!-- Day Content -->
            <div style="min-height: 120px;">
                {% if day.entry and day.entry.has_content %}
                    <!-- Entry Preview -->
                    <div style="margin-bottom: 15px; position: relative;">
                        <!-- Entry Actions -->
                        <div class="entry-actions" style="position: absolute; top: 0; right: 0; display: flex; gap: 5px; opacity: 0; transition: opacity 0.2s;">
                            <button class="btn btn-sm btn-outline-primary" onclick="loadEntryModal('{{ day.date|date:'Y-m-d' }}')" title="Edit entry">
                                <i class="fas fa-edit" style="font-size: 0.8rem;"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteEntry({{ day.entry.id }})" title="Delete entry">
                                <i class="fas fa-trash" style="font-size: 0.8rem;"></i>
                            </button>
                        </div>
                        
                        {% if day.entry.title %}
                            <div style="font-weight: 600; color: #2c3e50; margin-bottom: 8px; font-size: 1.1rem; padding-right: 60px;">{{ day.entry.title|truncatechars:50 }}</div>
                        {% endif %}
                        
                        {% if day.entry.content %}
                            <div style="color: #6c757d; font-size: 0.95rem; line-height: 1.4; margin-bottom: 10px;">{{ day.entry.content|truncatechars:80 }}</div>
                        {% endif %}
                        
        {% if day.entry.mood_rating %}
            <div style="display: inline-flex; align-items: center; gap: 8px; padding: 6px 12px; background: #f8f9fa; border-radius: 20px; font-size: 0.9rem; color: #495057; margin-bottom: 10px;">
                <span>Mood: {{ day.entry.mood_emoji }}</span>
            </div>
        {% endif %}
        
        {% if day.entry.gratitude_text %}
            <div style="background: #fff8e7; padding: 12px; border-radius: 10px; border-left: 4px solid #ffc107; margin-top: 10px; font-style: italic; color: #856404; font-size: 0.9rem;">
                <strong>Grateful for:</strong> "{{ day.entry.gratitude_text|truncatechars:60 }}"
            </div>
        {% endif %}
                    </div>
                {% else %}
                    <!-- Empty Day -->
                    <div style="text-align: center; color: #adb5bd; font-style: italic; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 15px;">
                        <div style="font-size: 3rem; opacity: 0.5;">üìù</div>
                        <div style="font-size: 1.1rem;">No entry yet</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">Click to add your daily wins!</div>
                    </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Entry Modal (will be populated via AJAX) -->
<div class="modal fade" id="entryModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" id="modal-content">
            <!-- Content loaded via AJAX -->
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Handle day card clicks
    document.querySelectorAll('.day-card-clickable').forEach(card => {
        card.addEventListener('click', function() {
            const date = this.dataset.date;
            loadEntryModal(date);
        });
    });
});

function loadEntryModal(date) {
    const modalElement = new bootstrap.Modal(document.getElementById('entryModal'));
    
    // show loading spinner
    document.getElementById('modal-content').innerHTML = `
        <div class="modal-body text-center p-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading your entry...</p>
        </div>
    `;
    modalElement.show();
    
    // get entry data from server
    fetch('/entry/' + date + '/')
        .then(response => response.json())
        .then(data => {
            document.getElementById('modal-content').innerHTML = data.html;
            
            // setup form handling
            initializeModalForm(date);
        })
        .catch(error => {
            console.error('Error loading entry:', error);
            // TODO: better error handling
            document.getElementById('modal-content').innerHTML = `
                <div class="modal-body text-center p-5">
                    <div class="text-danger">
                        <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>
                        <h5>Error Loading Entry</h5>
                        <p>Please try again later.</p>
                    </div>
                </div>
            `;
        });
}

function initializeModalForm(date) {
    const form = document.getElementById('entry-form');
    if (!form) return;
    
    // Initialize category click handlers
    initializeCategoryHandlers();
    
    // Initialize manage categories button
    const manageCategoriesBtn = document.getElementById('manageCategoriesBtn');
    if (manageCategoriesBtn) {
        console.log('‚úÖ Manage categories button found! Adding event listener...');
        manageCategoriesBtn.addEventListener('click', function() {
            console.log('üî• Manage categories button clicked!');
            openCategoryManager();
        });
    } else {
        console.error('‚ùå Manage categories button not found!');
    }
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        
        fetch('/entry/' + date + '/', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Close modal and refresh the page to show updated card
                bootstrap.Modal.getInstance(document.getElementById('entryModal')).hide();
                location.reload();
            } else {
                // Show form errors
                console.error('Form errors:', data.errors);
                // You could display errors in the modal here
            }
        })
        .catch(error => {
            console.error('Error saving entry:', error);
        });
    });
}

// Initialize category click handlers
function initializeCategoryHandlers() {
    document.querySelectorAll('.category-item').forEach(function(item) {
        item.addEventListener('click', function(e) {
            if (e.target.type !== 'checkbox' && !e.target.matches('label')) {
                const checkbox = this.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.checked = !checkbox.checked;
                    checkbox.dispatchEvent(new Event('change'));
                }
            }
        });
    });
}

// Category Manager Functions
function openCategoryManager() {
    console.log('=== Opening category manager ===');
    
    const modalElement = document.getElementById('categoryManagerModal');
    if (!modalElement) {
        console.error('‚ùå Modal element not found');
        alert('Error: Category manager modal not found in the DOM.');
        return;
    }
    
    loadUserCategories();
    
    const categoryModal = new bootstrap.Modal(modalElement);
    categoryModal.show();
}

function loadUserCategories() {
    console.log('Loading user categories...');
    
    const categoryList = document.getElementById('category-list');
    if (categoryList) {
        categoryList.innerHTML = '<div class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading categories...</div>';
    }
    
    fetch('/categories/ajax/list/')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            displayCategories(data.categories);
        } else {
            console.error('Failed to load categories');
            if (categoryList) {
                categoryList.innerHTML = '<div class="text-danger">Failed to load categories</div>';
            }
        }
    })
    .catch(error => {
        console.error('Error loading categories:', error);
        if (categoryList) {
            categoryList.innerHTML = '<div class="text-danger">Error loading categories</div>';
        }
    });
}

function displayCategories(categories) {
    console.log('üìã Displaying categories:', categories);
    const categoryList = document.getElementById('category-list');
    
    if (!categoryList) {
        console.error('‚ùå Category list element not found');
        return;
    }
    
    if (categories.length === 0) {
        categoryList.innerHTML = `
            <div class="text-center text-muted p-4">
                <i class="fas fa-tags fa-2x mb-3 text-secondary"></i>
                <h6>No categories yet!</h6>
                <p class="small">Create your first category using the button below.</p>
            </div>
        `;
        return;
    }
    
    let html = '<div class="list-group list-group-flush">';
    categories.forEach(category => {
        html += `
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <div class="category-color-circle me-3" style="background-color: ${category.color}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 0 0 1px #dee2e6;"></div>
                    <span class="fw-medium">${category.name}</span>
                </div>
                <div class="btn-group" role="group">
                    <button class="btn btn-outline-warning btn-sm" onclick="editCategory(${category.id})" title="Edit category">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="deleteCategory(${category.id})" title="Delete category">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `;
    });
    html += '</div>';
    
    categoryList.innerHTML = html;
    console.log('‚úÖ Categories displayed successfully');
}

// Category deletion with confirmation
function deleteCategory(categoryId) {
    if (!confirm('Are you sure you want to delete this category?')) {
        return;
    }
    
    fetch(`/categories/${categoryId}/ajax/delete/`, {
        method: 'DELETE',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            loadUserCategories();
            alert('Category deleted successfully!');
        } else {
            alert('Error deleting category: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error deleting category:', error);
        alert('Error deleting category');
    });
}

// Create new category via AJAX
function createCategory() {
    console.log('üé® Creating new category...');
    const nameInput = document.getElementById('categoryName');
    const colorInput = document.getElementById('categoryColor');
    
    // Validate form inputs exist
    if (!nameInput || !colorInput) {
        console.error('‚ùå Category form inputs not found');
        alert('Category form inputs not found');
        return;
    }
    
    const name = nameInput.value.trim();
    const color = colorInput.value;
    
    console.log('üìù Category data:', { name, color });
    
    if (!name) {
        alert('Please enter a category name');
        nameInput.focus();
        return;
    }
    
    // Prepare form data for submission
    const formData = new FormData();
    formData.append('name', name);
    formData.append('color', color);
    formData.append('description', ''); // Empty description since it's optional
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    console.log('üöÄ Sending create request...');
    
    // Submit to server
    fetch('/categories/ajax/create/', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('üì° Response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('üì¶ Response data:', data);
        if (data.success) {
            // Clear form and reload categories
            nameInput.value = '';
            colorInput.value = '#007bff';
            loadUserCategories();
            toggleCategoryForm();
            alert('Category created successfully!');
        } else {
            console.error('‚ùå Server error:', data);
            alert('Error creating category: ' + (data.error || JSON.stringify(data.errors)));
        }
    })
    .catch(error => {
        console.error('‚ùå Network error:', error);
        alert('Error creating category: ' + error.message);
    });
}

function toggleCategoryForm() {
    console.log('üéØ toggleCategoryForm() called!');
    const form = document.getElementById('quickCategoryForm');
    const button = document.querySelector('[onclick="toggleCategoryForm()"]');
    
    console.log('Form element:', form);
    console.log('Button element:', button);
    
    if (form && button) {
        const isFormVisible = form.style.display !== 'none' && form.style.display !== '';
        
        if (isFormVisible) {
            form.style.display = 'none';
            button.innerHTML = '<i class="fas fa-plus me-2"></i>Add New Category';
            console.log('‚úÖ Form hidden');
        } else {
            form.style.display = 'block';
            button.innerHTML = '<i class="fas fa-minus me-2"></i>Cancel';
            console.log('‚úÖ Form shown');
            
            // Focus on the name input when showing the form
            const nameInput = document.getElementById('categoryName');
            if (nameInput) {
                setTimeout(() => nameInput.focus(), 100);
            }
        }
    } else {
        console.error('‚ùå Form or button not found');
        console.log('Available elements with onclick="toggleCategoryForm()":');
        console.log(document.querySelectorAll('[onclick="toggleCategoryForm()"]'));
    }
}

function refreshCategoriesInMainForm() {
    fetch('/categories/ajax/list/')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const categoriesContainer = document.querySelector('.category-checkboxes-custom');
            if (categoriesContainer) {
                let html = '';
                if (data.categories.length === 0) {
                    html = `
                        <div class="no-categories-message">
                            <i class="fas fa-info-circle text-muted me-2"></i>
                            <span class="text-muted">No categories yet. Click "Manage" to create some!</span>
                        </div>
                    `;
                } else {
                    data.categories.forEach(category => {
                        html += `
                            <div class="category-item">
                                <input 
                                    type="checkbox" 
                                    id="id_categories_${category.id}" 
                                    name="categories" 
                                    value="${category.id}"
                                    class="category-checkbox">
                                <label for="id_categories_${category.id}" class="category-label">
                                    <span class="category-color-dot" style="background-color: ${category.color};"></span>
                                    ${category.name}
                                </label>
                            </div>
                        `;
                    });
                }
                categoriesContainer.innerHTML = html;
                
                // Re-attach click handlers
                initializeCategoryHandlers();
                
                alert('Categories refreshed successfully!');
            }
        } else {
            alert('Error refreshing categories');
        }
    })
    .catch(error => {
        console.error('Error refreshing categories:', error);
        alert('Refresh failed, but endpoint exists! Check console.');
    });
    
    // Close the modal
    const categoryModal = bootstrap.Modal.getInstance(document.getElementById('categoryManagerModal'));
    if (categoryModal) {
        categoryModal.hide();
    }
}

// Edit category functionality
function editCategory(categoryId) {
    console.log('‚úèÔ∏è Editing category:', categoryId);
    
    // First, fetch the current category data
    fetch('/categories/ajax/list/')
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const category = data.categories.find(cat => cat.id === categoryId);
            if (category) {
                // Populate the edit form
                showEditCategoryForm(category);
            } else {
                alert('Category not found');
            }
        } else {
            alert('Error loading category data');
        }
    })
    .catch(error => {
        console.error('Error loading category for edit:', error);
        alert('Error loading category data');
    });
}

function showEditCategoryForm(category) {
    // Hide the regular add form if it's showing
    const addForm = document.getElementById('quickCategoryForm');
    if (addForm && addForm.style.display !== 'none') {
        toggleCategoryForm();
    }
    
    // Show/create edit form
    let editForm = document.getElementById('editCategoryForm');
    if (!editForm) {
        // Create edit form if it doesn't exist
        const categoryList = document.getElementById('category-list');
        const editFormHtml = `
            <div class="edit-category-form mb-3" id="editCategoryForm" style="display: none;">
                <div class="card border-warning">
                    <div class="card-body">
                        <h6 class="card-title text-warning">
                            <i class="fas fa-edit me-2"></i>Edit Category
                        </h6>
                        <div class="row g-2">
                            <div class="col-8">
                                <input type="text" class="form-control" id="editCategoryName" placeholder="Enter category name">
                            </div>
                            <div class="col-4">
                                <input type="color" class="form-control form-control-color" id="editCategoryColor" title="Choose color">
                            </div>
                        </div>
                        <div class="mt-3 text-end">
                            <button type="button" class="btn btn-secondary btn-sm me-2" onclick="cancelEditCategory()">
                                <i class="fas fa-times me-1"></i>Cancel
                            </button>
                            <button type="button" class="btn btn-warning btn-sm" onclick="saveEditCategory()">
                                <i class="fas fa-save me-1"></i>Save Changes
                            </button>
                        </div>
                        <input type="hidden" id="editCategoryId">
                    </div>
                </div>
            </div>
        `;
        categoryList.insertAdjacentHTML('beforebegin', editFormHtml);
        editForm = document.getElementById('editCategoryForm');
    }
    
    // Populate the form with current category data
    document.getElementById('editCategoryName').value = category.name;
    document.getElementById('editCategoryColor').value = category.color;
    document.getElementById('editCategoryId').value = category.id;
    
    // Show the edit form
    editForm.style.display = 'block';
    
    // Focus on the name input
    setTimeout(() => document.getElementById('editCategoryName').focus(), 100);
}

function cancelEditCategory() {
    const editForm = document.getElementById('editCategoryForm');
    if (editForm) {
        editForm.style.display = 'none';
    }
}

function saveEditCategory() {
    const nameInput = document.getElementById('editCategoryName');
    const colorInput = document.getElementById('editCategoryColor');
    const idInput = document.getElementById('editCategoryId');
    
    if (!nameInput || !colorInput || !idInput) {
        alert('Edit form inputs not found');
        return;
    }
    
    const name = nameInput.value.trim();
    const color = colorInput.value;
    const categoryId = idInput.value;
    
    if (!name) {
        alert('Please enter a category name');
        nameInput.focus();
        return;
    }
    
    console.log('üíæ Saving category changes:', { id: categoryId, name, color });
    
    const formData = new FormData();
    formData.append('name', name);
    formData.append('color', color);
    formData.append('description', ''); // Empty description since it's optional
    formData.append('csrfmiddlewaretoken', document.querySelector('[name=csrfmiddlewaretoken]').value);
    
    fetch(`/categories/${categoryId}/edit/`, {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) {
            console.log('‚úÖ Category updated successfully');
            // Hide edit form and reload categories
            cancelEditCategory();
            loadUserCategories();
            alert('Category updated successfully!');
        } else {
            console.error('‚ùå Error updating category, status:', response.status);
            alert('Error updating category. Please try again.');
        }
    })
    .catch(error => {
        console.error('‚ùå Network error updating category:', error);
        alert('Error updating category. Please check your connection and try again.');
    });
}

// Entry delete functionality
function deleteEntry(entryId) {
    if (!confirm('Are you sure you want to delete this entry? This action cannot be undone.')) {
        return;
    }
    
    console.log('üóëÔ∏è Deleting entry:', entryId);
    
    fetch(`/entries/${entryId}/delete/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            'Content-Type': 'application/x-www-form-urlencoded',
        }
    })
    .then(response => {
        if (response.ok) {
            console.log('‚úÖ Entry deleted successfully');
            // Refresh the page to show updated content
            location.reload();
        } else {
            console.error('‚ùå Error deleting entry, status:', response.status);
            alert('Error deleting entry. Please try again.');
        }
    })
    .catch(error => {
        console.error('‚ùå Network error deleting entry:', error);
        alert('Error deleting entry. Please check your connection and try again.');
    });
}

// Make functions globally available for onclick handlers in dynamically loaded content
window.toggleCategoryForm = toggleCategoryForm;
window.createCategory = createCategory;
window.deleteCategory = deleteCategory;
window.refreshCategoriesInMainForm = refreshCategoriesInMainForm;
window.deleteEntry = deleteEntry;
window.editCategory = editCategory;
window.showEditCategoryForm = showEditCategoryForm;
window.cancelEditCategory = cancelEditCategory;
window.saveEditCategory = saveEditCategory;
</script>

<style>
/* Mobile responsive */
@media (max-width: 768px) {
    .week-container {
        padding: 10px;
    }
    
    .week-container h1 {
        font-size: 2rem !important;
    }
}

/* Entry actions hover effect */
.day-card:hover .entry-actions {
    opacity: 1 !important;
}

.entry-actions .btn {
    background-color: rgba(255, 255, 255, 0.95);
    border-color: rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(5px);
}

.entry-actions .btn:hover {
    transform: scale(1.1);
    transition: transform 0.1s ease;
}

/* Rainbow gradient animation for header */
@keyframes gradient-shift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}
</style>

{% endblock %}